generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BasketType {
  BIG
  SMALL
}

model Place {
  id            Int         @id @default(autoincrement())
  name          String
  type          PlaceType // "WAREHOUSE", "STORE", "VAN"
  inventories   Inventory[]
  movementsFrom Movement[]  @relation("MovementFrom")
  movementsTo   Movement[]  @relation("MovementTo")

  routeStores RouteStore[]
}

enum PlaceType {
  WAREHOUSE
  STORE
  VAN
}

model Driver {
  id        Int        @id @default(autoincrement())
  name      String
  van       Van?       @relation(fields: [vanId], references: [id])
  vanId     Int?       @unique
  routes    Route[]
  movements Movement[] // One-to-many: a driver has many movements
}

model Van {
  id          Int     @id @default(autoincrement())
  plateNumber String  @unique
  driver      Driver?
}

model Route {
  id          Int          @id @default(autoincrement())
  name        String
  driver      Driver?       @relation(fields: [driverId], references: [id])
  driverId    Int?
  routeStores RouteStore[]
  createdAt   DateTime     @default(now())
}

model RouteStore {
  id      Int   @id @default(autoincrement())
  route   Route @relation(fields: [routeId], references: [id])
  routeId Int
  place   Place @relation(fields: [placeId], references: [id])
  placeId Int
  order   Int // store visit order in the route
}

model Inventory {
  id      Int   @id @default(autoincrement())
  place   Place @relation(fields: [placeId], references: [id])
  placeId Int

  basketType BasketType
  quantity   Int

  updatedAt DateTime @updatedAt

  @@unique([placeId, basketType])
}

model Movement {
  id          Int        @id @default(autoincrement())
  fromPlace   Place?     @relation("MovementFrom", fields: [fromPlaceId], references: [id])
  fromPlaceId Int?
  toPlace     Place?     @relation("MovementTo", fields: [toPlaceId], references: [id])
  toPlaceId   Int?
  quantity    Int
  basketType  BasketType

  driver   Driver @relation(fields: [driverId], references: [id]) // âœ… required
  driverId Int

  timestamp DateTime @default(now())
}
